
<div class="beige-noise">
  <div class="p-wrapper">
    <div class="container"></div>
    <div class="row">
      <div class="col-sm-12">
        <section id="exports">
          <h1>exports</h1>
          <h5 class="subheader"></h5>
          <p>
            <!--mixin labelForSymbolType(symbol)--><span class="label label-info radius ctx-type">method</span><span>module.exports()</span>
          </p>
        </section>
        <div class="bs-example">
          <table class="table">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>rootPath</td>
                <td>String</td>
                <td>The root path of the application</td>
              </tr>
            </tbody>
          </table>
        </div>
        <tabset>
          <tab heading="Description">
            <div class="well"><p>Baboon<br />The core module from baboon</p>
            </div>
          </tab>
          <tab heading="Source">
            <div hljs="hljs">module.exports = function (rootPath) {

    // Set command line arguments
    var argv = stdio.getopt({
        'config': {key: 'c', args:1, description: 'Use the specified config section'},
        'port': {args:1, description: 'Use the specified port'},
        'protocol': {args:1, description: 'Use the specified protocol'},
        'livereload': {description: 'Use livereload snippet for client'}
    });

    // Baboon core
    var baboon = {};

    // Errors
    baboon.ValidationError = require('./errors').ValidationError;
    baboon.ControllerError = require('./errors').ControllerError;

    // Config
    baboon.config = require('./config')(rootPath, argv);

    // Loggers
    baboon.loggers = require('./logging')(baboon.config);

    // Session
    baboon.session = require('./session')(baboon.config.session, baboon.loggers.syslog);

    // Rights
    baboon.rights = require('./rights')(baboon.config, baboon.loggers);

    // Transport
    baboon.transport = require('./transport')(baboon);

    // Middleware
    baboon.middleware = {};

    // Middleware session
    baboon.middleware.session = middlewareSession(baboon);

    // Middleware auth
    baboon.middleware.auth = middlewareAuth(baboon);

    // ErrorHandler
    baboon.errorHandler = errorHandler(baboon.config, baboon.loggers.syslog).errorHandler;

    // Navigation
    navigationFilePath = path.resolve(path.join(rootPath,'.dist','navigation'));
    baboon.navigation = navigation(navigationFilePath);

    // Add navigation to transport
    baboon.transport.addController(baboon.navigation, 'navigation');

    // Add session to transport
    baboon.transport.addController(baboon.session, 'session');

    // Add account to transport
    baboon.transport.addController(account(baboon.config, baboon.loggers), 'account');
            </div>
          </tab>
        </tabset>
        <hr/>
        <section id="getServer">
          <h1>getServer</h1>
          <h5 class="subheader"></h5>
          <p>
            <!--mixin labelForSymbolType(symbol)--><span class="label label-info radius ctx-type">method</span><span>baboon.getServer()</span><span title="return value" class="glyphicon glyphicon-arrow-right"></span><span>Object</span>
          </p>
        </section>
        <div class="bs-example">
          <table class="table">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>app</td>
                <td>Object</td>
                <td>The application object</td>
              </tr>
            </tbody>
          </table>
        </div>
        <tabset>
          <tab heading="Description">
            <div class="well"><p>Get http or https server</p>
            </div>
          </tab>
          <tab heading="Source">
            <div hljs="hljs">baboon.getServer = function(app) {

        var server = {};

        // setup server to https or http from config protocol
        if (baboon.config.protocol === 'https') {
            var https = require('https'),
                serverOptions = {
                    key: fs.readFileSync(path.join(rootPath, 'ssl', 'ssl.key')),
                    cert: fs.readFileSync(path.join(rootPath, 'ssl', 'ssl.crt'))
                };

            server = https.createServer(serverOptions, app);
        }
        else if (baboon.config.protocol === 'http') {
            var http = require('http');
            server = http.createServer(app);
        } else {
            var msg = 'error server config - missing or wrong protocol: ' + baboon.config.protocol;
            baboon.loggers.syslog.error(msg);
            throw new Error(msg);
        }

        return server;
    };
            </div>
          </tab>
        </tabset>
        <hr/>
        <section id="appListen">
          <h1>appListen</h1>
          <h5 class="subheader"></h5>
          <p>
            <!--mixin labelForSymbolType(symbol)--><span class="label label-info radius ctx-type">method</span><span>baboon.appListen()</span>
          </p>
        </section>
        <div class="bs-example">
          <table class="table">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>app</td>
                <td>Object</td>
                <td>The express app object</td>
              </tr>
            </tbody>
          </table>
        </div>
        <tabset>
          <tab heading="Description">
            <div class="well"><p>App listen on port</p>
            </div>
          </tab>
          <tab heading="Source">
            <div hljs="hljs">baboon.appListen = function(app) {
        var config = baboon.config;
        var startOn = 'server has been started on: ' + config.protocol + '://' + config.host + ':' + config.port;
        var startMode = 'server has been started in ' + config.node_env + ' mode';
        var syslog = baboon.loggers.syslog;

        return app.listen(config.port, config.host, function () {
            syslog.info(startOn);
            syslog.debug(startMode);

            if (config.logging.loggers.syslog.appender !== 'console') {
                console.log(clc.cyan('   info  - ') + startOn);
            }
        });
    };

    return baboon;
};
            </div>
          </tab>
        </tabset>
        <hr/>
      </div>
    </div>
  </div>
</div>