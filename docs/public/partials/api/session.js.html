
<div class="beige-noise">
  <div class="p-wrapper">
    <div class="container"></div>
    <div class="row">
      <div class="col-sm-12">
        <section id="getSessionStore">
          <h1>getSessionStore</h1>
          <h5 class="subheader"></h5>
          <p>
            <!--mixin labelForSymbolType(symbol)--><span class="label label-info radius ctx-type">method</span><span>pub.getSessionStore()</span>
          </p>
        </section>
        <tabset>
          <tab heading="Description">
            <div class="well"><p>Get session store</p>
            </div>
          </tab>
          <tab heading="Source">
            <div hljs="hljs">pub.getSessionStore = function () {
        return sessionStore;
    };
            </div>
          </tab>
        </tabset>
        <hr/>
        <section id="getSessionId">
          <h1>getSessionId</h1>
          <h5 class="subheader"></h5>
          <p>
            <!--mixin labelForSymbolType(symbol)--><span class="label label-info radius ctx-type">method</span><span>pub.getSessionId()</span>
          </p>
        </section>
        <div class="bs-example">
          <table class="table">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>cookie</td>
                <td>String</td>
                <td></td>
              </tr>
            </tbody>
          </table>
        </div>
        <tabset>
          <tab heading="Description">
            <div class="well"><p>Get sessionId from signed cookie</p>
            </div>
          </tab>
          <tab heading="Source">
            <div hljs="hljs">pub.getSessionId = function (cookie) {

        if (typeof cookie !== 'string') {
            throw new SessionError('Parameter cookie is required and must be a string type!');
        }

        var signedCookie = cookies.parse(cookie);
        return parseSignedCookie(signedCookie, secret)[key];
    };
            </div>
          </tab>
        </tabset>
        <hr/>
        <section id="getSession">
          <h1>getSession</h1>
          <h5 class="subheader"></h5>
          <p>
            <!--mixin labelForSymbolType(symbol)--><span class="label label-info radius ctx-type">method</span><span>pub.getSession()</span>
          </p>
        </section>
        <div class="bs-example">
          <table class="table">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>cookie</td>
                <td>String</td>
                <td></td>
              </tr>
              <tr>
                <td>callback</td>
                <td>Function</td>
                <td></td>
              </tr>
            </tbody>
          </table>
        </div>
        <tabset>
          <tab heading="Description">
            <div class="well"><p>Get session from session store with cookie</p>
            </div>
          </tab>
          <tab heading="Source">
            <div hljs="hljs">pub.getSession = function (cookie, callback) {

        if (typeof cookie !== 'string') {
            throw new SessionError('Parameter cookie is required and must be a string type!');
        }

        if (typeof callback !== 'function') {
            throw new SessionError('Parameter callback is required and must be a object type!');
        }

        var sid = pub.getSessionId(cookie);

        sessionStore.get(sid, function (error, session) {
            if (error || !session) {
                callback(error || new SessionError('session ' + sid + ': not found', 400));
            }
            else {
                callback(null, session);
            }
        });
    };
            </div>
          </tab>
        </tabset>
        <hr/>
        <section id="getSessionById">
          <h1>getSessionById</h1>
          <h5 class="subheader"></h5>
          <p>
            <!--mixin labelForSymbolType(symbol)--><span class="label label-info radius ctx-type">method</span><span>pub.getSessionById()</span>
          </p>
        </section>
        <div class="bs-example">
          <table class="table">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>sid</td>
                <td>String</td>
                <td></td>
              </tr>
              <tr>
                <td>callback</td>
                <td>Function</td>
                <td></td>
              </tr>
            </tbody>
          </table>
        </div>
        <tabset>
          <tab heading="Description">
            <div class="well"><p>Get session from session store with cookie</p>
            </div>
          </tab>
          <tab heading="Source">
            <div hljs="hljs">pub.getSessionById = function (sid, callback) {

        if (typeof sid !== 'string') {
            throw new SessionError('Parameter sid is required and must be a string type!');
        }

        if (typeof callback !== 'function') {
            throw new SessionError('Parameter callback is required and must be a object type!');
        }

        sessionStore.get(sid, function (error, session) {
            if (error || !session) {
                callback(error || new SessionError('session ' + sid + ': not found', 400));
            }
            else {
                callback(null, session);
            }
        });
    };
            </div>
          </tab>
        </tabset>
        <hr/>
        <section id="setSession">
          <h1>setSession</h1>
          <h5 class="subheader"></h5>
          <p>
            <!--mixin labelForSymbolType(symbol)--><span class="label label-info radius ctx-type">method</span><span>pub.setSession()</span>
          </p>
        </section>
        <div class="bs-example">
          <table class="table">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>session</td>
                <td>Object</td>
                <td></td>
              </tr>
              <tr>
                <td>callback</td>
                <td>Function</td>
                <td></td>
              </tr>
            </tbody>
          </table>
        </div>
        <tabset>
          <tab heading="Description">
            <div class="well"><p>Save session in store</p>
            </div>
          </tab>
          <tab heading="Source">
            <div hljs="hljs">pub.setSession = function (session, callback) {

        if (typeof session !== 'object') {
            throw new SessionError('Parameter session is required and must be a object type!');
        }

        if (typeof callback !== 'function') {
            throw new SessionError('Parameter callback is required and must be a object type!');
        }

        sessionStore.set(session.id, session, function (error) {

            if (error) {
                callback(new SessionError(error, 400));
            }
            else {
                callback(null, true);
            }
        });
    };
            </div>
          </tab>
        </tabset>
        <hr/>
        <section id="checkActivitySession">
          <h1>checkActivitySession</h1>
          <h5 class="subheader"></h5>
          <p>
            <!--mixin labelForSymbolType(symbol)--><span class="label label-info radius ctx-type">method</span><span>pub.checkActivitySession()</span>
          </p>
        </section>
        <div class="bs-example">
          <table class="table">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>session</td>
                <td>Object</td>
                <td></td>
              </tr>
              <tr>
                <td>callback</td>
                <td>Function</td>
                <td></td>
              </tr>
            </tbody>
          </table>
        </div>
        <tabset>
          <tab heading="Description">
            <div class="well"><p>Check session activity<br />Checks the inactive and max life time of session.<br />Is the time exceeded then regenerated the session.</p>
            </div>
          </tab>
          <tab heading="Source">
            <div hljs="hljs">pub.checkActivitySession = function (session, callback) {

        if (typeof session !== 'object') {
            throw new SessionError('Parameter session is required and must be a object type!');
        }

        if (typeof callback !== 'function') {
            throw new SessionError('Parameter callback is required and must be a object type!');
        }

        //check session activity time
        var activity = new Date(session.activity);
        var start = new Date(session.start);
        var end = new Date();
        var inactiveDifference = (end - activity) / 1000;
        var maxDifference = (end - start) / 1000;

        // check activity time
        if (config.inactiveTime &lt; inactiveDifference || config.maxLife &lt; maxDifference) {

            // to long inactive, regenerate session
            session.regenerate(function () {

                syslog.warn('session too long inactive or session expired, regenerate session.');
                callback(null, false);
            });
        }
        else {

            // session ok, renewal activity time
            session.activity = new Date();
            callback(null, true);
        }
    };


    // API for transport
            </div>
          </tab>
        </tabset>
        <hr/>
        <section id="setActivity">
          <h1>setActivity</h1>
          <h5 class="subheader"></h5>
          <p>
            <!--mixin labelForSymbolType(symbol)--><span class="label label-info radius ctx-type">method</span><span>pub.setActivity()</span>
          </p>
        </section>
        <div class="bs-example">
          <table class="table">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>data</td>
                <td>!Object</td>
                <td></td>
              </tr>
              <tr>
                <td>request</td>
                <td>!Object</td>
                <td></td>
              </tr>
              <tr>
                <td>callback</td>
                <td>!Function</td>
                <td></td>
              </tr>
            </tbody>
          </table>
        </div>
        <tabset>
          <tab heading="Description">
            <div class="well"><p>setActivity<br />Report activity to session</p>
            </div>
          </tab>
          <tab heading="Source">
            <div hljs="hljs">pub.setActivity = function (data, request, callback) {

        pub.checkActivitySession(request.session, function (error, result) {
            if (!error &amp;&amp; result) {
                request.setSession(callback);
            }
            else {

                var activityError = error || new SessionError(
                    'Session too long inactive or session expired, regenerate session.', 400);

                request.setSession(function (error, result) {

                    if (!error &amp;&amp; result) {
                        callback(activityError);
                    }
                    else {
                        callback(error || new SessionError('Unknown session error in setSession', 400));
                    }
                });
            }
        });
    };
            </div>
          </tab>
        </tabset>
        <hr/>
        <section id="getLastActivity">
          <h1>getLastActivity</h1>
          <h5 class="subheader"></h5>
          <p>
            <!--mixin labelForSymbolType(symbol)--><span class="label label-info radius ctx-type">method</span><span>pub.getLastActivity()</span>
          </p>
        </section>
        <div class="bs-example">
          <table class="table">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>data</td>
                <td>!Object</td>
                <td></td>
              </tr>
              <tr>
                <td>request</td>
                <td>!Object</td>
                <td></td>
              </tr>
              <tr>
                <td>callback</td>
                <td>!Function</td>
                <td></td>
              </tr>
            </tbody>
          </table>
        </div>
        <tabset>
          <tab heading="Description">
            <div class="well"><p>getLastActivity<br />Get last session activity</p>
            </div>
          </tab>
          <tab heading="Source">
            <div hljs="hljs">pub.getLastActivity = function (data, request, callback) {

        if (!request.session.hasOwnProperty('activity')) {
            callback(new SessionError('Property activity not found in session', 400));
        }
        else {
            callback(null, {activity: request.session.activity});
        }
    };
            </div>
          </tab>
        </tabset>
        <hr/>
        <section id="getData">
          <h1>getData</h1>
          <h5 class="subheader"></h5>
          <p>
            <!--mixin labelForSymbolType(symbol)--><span class="label label-info radius ctx-type">method</span><span>pub.getData()</span>
          </p>
        </section>
        <div class="bs-example">
          <table class="table">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>data</td>
                <td>!Object</td>
                <td></td>
              </tr>
              <tr>
                <td>request</td>
                <td>!Object</td>
                <td></td>
              </tr>
              <tr>
                <td>callback</td>
                <td>!Function</td>
                <td></td>
              </tr>
            </tbody>
          </table>
        </div>
        <tabset>
          <tab heading="Description">
            <div class="well"><p>getData<br />Read data from session container data</p>
            </div>
          </tab>
          <tab heading="Source">
            <div hljs="hljs">pub.getData = function (data, request, callback) {

        if (!request.session.data) {
            request.session.data = {};
        }

        var key = data.key;
        var obj = {};

        if (typeof key === 'undefined') {
            obj = request.session.data;
        }
        else {
            // check own key
            if (!request.session.data.hasOwnProperty(key)) {
                return callback(new SessionError('Key: ' + key + ' not found in session container', 400));
            }
            else {
                obj[key] = request.session.data[key];
            }
        }

        return callback(null, obj);
    };
            </div>
          </tab>
        </tabset>
        <hr/>
        <section id="setData">
          <h1>setData</h1>
          <h5 class="subheader"></h5>
          <p>
            <!--mixin labelForSymbolType(symbol)--><span class="label label-info radius ctx-type">method</span><span>pub.setData()</span>
          </p>
        </section>
        <div class="bs-example">
          <table class="table">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>data</td>
                <td>!Object</td>
                <td></td>
              </tr>
              <tr>
                <td>request</td>
                <td>!Object</td>
                <td></td>
              </tr>
              <tr>
                <td>callback</td>
                <td>!Function</td>
                <td></td>
              </tr>
            </tbody>
          </table>
        </div>
        <tabset>
          <tab heading="Description">
            <div class="well"><p>setData<br />Store data in the session container data</p>
            </div>
          </tab>
          <tab heading="Source">
            <div hljs="hljs">pub.setData = function (data, request, callback) {

        // check params
        if (!data.key) {
            return callback(new SessionError('Parameter key is required', 400));
        }

        if (!data.value) {
            return callback(new SessionError('Parameter value is required', 400));
        }

        if (!request.session.data) {
            request.session.data = {};
        }

        // save key value in session
        request.session.data[data.key] = data.value;

        return callback(null, data.key + ' is saved in session');
    };
            </div>
          </tab>
        </tabset>
        <hr/>
        <section id="deleteData">
          <h1>deleteData</h1>
          <h5 class="subheader"></h5>
          <p>
            <!--mixin labelForSymbolType(symbol)--><span class="label label-info radius ctx-type">method</span><span>pub.deleteData()</span>
          </p>
        </section>
        <div class="bs-example">
          <table class="table">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>data</td>
                <td>!Object</td>
                <td></td>
              </tr>
              <tr>
                <td>request</td>
                <td>!Object</td>
                <td></td>
              </tr>
              <tr>
                <td>callback</td>
                <td>!Function</td>
                <td></td>
              </tr>
            </tbody>
          </table>
        </div>
        <tabset>
          <tab heading="Description">
            <div class="well"><p>deleteData<br />Delete data from session container</p>
            </div>
          </tab>
          <tab heading="Source">
            <div hljs="hljs">pub.deleteData = function (data, request, callback) {

        if (!request.session.data) {
            request.session.data = {};
            return callback(null, 'container session.data deleted');
        }

        var key = data.key;

        if (typeof key === 'undefined') {
            request.session.data = {};
            return callback(null, 'container session.data deleted');
        }

        // check own key
        if (!request.session.data.hasOwnProperty(key)) {
            return callback(new SessionError('Key: ' + key + ' not found in session container', 400));
        }
        else {
            // delete key value in session
            delete request.session.data[key];
            return callback(null, key + ' is deleted in session');
        }
    };

    return pub;
};
            </div>
          </tab>
        </tabset>
        <hr/>
      </div>
    </div>
  </div>
</div>