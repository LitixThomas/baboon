
<div class="beige-noise">
  <div class="p-wrapper">
    <div class="container"></div>
    <div class="row">
      <div class="col-sm-12">
        <section id="exports">
          <h1>exports</h1>
          <h5 class="subheader"></h5>
          <p>
            <!--mixin labelForSymbolType(symbol)--><span class="label label-info radius ctx-type">method</span><span>module.exports()</span><span title="return value" class="glyphicon glyphicon-arrow-right"></span><span>Object</span>
          </p>
        </section>
        <div class="bs-example">
          <table class="table">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>config</td>
                <td>Object</td>
                <td>The mail config object.</td>
              </tr>
            </tbody>
          </table>
        </div>
        <tabset>
          <tab heading="Description">
            <div class="well"><p>The mail module.</p>
            </div>
          </tab>
          <tab heading="Source">
            <div hljs="hljs">module.exports = function (config) {
    if (typeof config !== 'object') {
        throw new MailError('Parameter config is required!');
    }

    if (!config.type) {
        config.type = 'SMTP';
    }
    else if (config.type !== 'SMTP' &amp;&amp; config.type !== 'PICKUP') {
        throw new MailError('Only SMTP or PICKUP allowed!');
    }

    var options = {
        maxConnections: config.maxConnections,
        maxMessages: config.maxMessages,
        debug: config.debug,
        ignoreTLS: config.ignoreTLS
    };

    if (config.type === 'SMTP') {
        options.host = config.host;
        options.port = config.port;
        options.auth = config.auth;
        options.secureConnection = config.useSsl;
    }
    else { // must be &quot;PICKUP&quot; because of validation before
        options.directory = config.directory;
    }

    var transport = mailer.createTransport(config.type, options);
    var pub = {};

    function configureMail (mail) {
        return {
            from: mail.from || config.from,
            to: mail.to || config.to,
            cc: mail.cc,
            bcc: mail.bcc,
            subject: mail.subject,
            text: mail.text,
            html: mail.html,
            generateTextFromHTML: mail.generateTextFromHTML || true
        };
    }
            </div>
          </tab>
        </tabset>
        <hr/>
        <section id="sendMail">
          <h1>sendMail</h1>
          <h5 class="subheader"></h5>
          <p>
            <!--mixin labelForSymbolType(symbol)--><span class="label label-info radius ctx-type">method</span><span>pub.sendMail()</span>
          </p>
        </section>
        <div class="bs-example">
          <table class="table">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>mail</td>
                <td>Object</td>
                <td>The mail message object.</td>
              </tr>
              <tr>
                <td>callback</td>
                <td>function</td>
                <td>The callback function.</td>
              </tr>
            </tbody>
          </table>
        </div>
        <tabset>
          <tab heading="Description">
            <div class="well"><p>Sends a mail with the specified mail message.</p>
            </div>
          </tab>
          <tab heading="Source">
            <div hljs="hljs">pub.sendMail = function (mail, callback) {
        var mailMessage = configureMail(mail);

        transport.sendMail(mailMessage, function (error, result) {
            callback(error, result);
        });
    };
            </div>
          </tab>
        </tabset>
        <hr/>
        <section id="sendMailFromTemplate">
          <h1>sendMailFromTemplate</h1>
          <h5 class="subheader"></h5>
          <p>
            <!--mixin labelForSymbolType(symbol)--><span class="label label-info radius ctx-type">method</span><span>pub.sendMailFromTemplate()</span>
          </p>
        </section>
        <div class="bs-example">
          <table class="table">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>mail</td>
                <td>Object</td>
                <td>The mail message object.</td>
              </tr>
              <tr>
                <td>htmlFile</td>
                <td>String</td>
                <td>Path to the html template.</td>
              </tr>
              <tr>
                <td>txtFile</td>
                <td>String</td>
                <td>Path to the text template.</td>
              </tr>
              <tr>
                <td>replaceValues</td>
                <td>Object</td>
                <td>An array with key value objects to replace dynamic content.</td>
              </tr>
              <tr>
                <td>callback</td>
                <td>function</td>
                <td>The callback function.</td>
              </tr>
            </tbody>
          </table>
        </div>
        <tabset>
          <tab heading="Description">
            <div class="well"><p>Sends a mail with the specified mail message und file templates.</p>
            </div>
          </tab>
          <tab heading="Source">
            <div hljs="hljs">pub.sendMailFromTemplate = function (mail, htmlFile, txtFile, replaceValues, callback) {
        var mailMessage = configureMail(mail);

        async.auto({
            readHtmlFile: function (next) {
                if (!htmlFile) {
                    next(null, '');
                }
                else {
                    fs.readFile(path.resolve(config.templatePath, htmlFile), { encoding: 'utf8' }, next);
                }
            },
            readTextFile: function (next) {
                if (!txtFile) {
                    next(null, '');
                }
                else {
                    fs.readFile(path.resolve(config.templatePath, txtFile), { encoding: 'utf8' }, next);
                }
            },
            sendMail: ['readHtmlFile', 'readTextFile', function (next, innerResults) {
                if (replaceValues) {
                    for (var i = 0; i &lt; replaceValues.length; i++) {
                        var item = replaceValues[i];
                        innerResults.readHtmlFile = innerResults.readHtmlFile.replace(item.key, item.value || '');
                        innerResults.readTextFile = innerResults.readTextFile.replace(item.key, item.value || '');
                    }
                }

                mailMessage.html = innerResults.readHtmlFile;
                mailMessage.text = innerResults.readTextFile;

                transport.sendMail(mailMessage, next);
            }]
        }, function (error, results) {
            if (error) {
                callback(error);
                return;
            }

            callback(error, results.sendMail);
        });
    };

    return pub;
};
            </div>
          </tab>
        </tabset>
        <hr/>
      </div>
    </div>
  </div>
</div>